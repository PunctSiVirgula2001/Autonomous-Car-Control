<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__motor_and_servo_control_8c_source" xml:lang="en-US">
<title>MotorAndServoControl.c</title>
<indexterm><primary>src/motors/MotorAndServoControl.c</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="__motor_and_servo_control_8c_source_1l00001"/>00001 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="__motor_and_servo_control_8h">MotorAndServoControl.h</link>&quot;</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00002"/>00002 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="__i2_c__camera_sensor_8h">I2C_cameraSensor.h</link>&quot;</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00003"/>00003 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="__network_8h">Network.h</link>&quot;</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00004"/>00004 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00005"/>00005 <emphasis role="comment">//Queue&#32;set&#32;which&#32;adds&#32;all&#32;data&#32;from&#32;all&#32;queues.</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00006"/><link linkend="_main_8c_1a5c87d10806c8bb41d42841fc2fb559d9">00006</link> QueueSetHandle_t&#32;<link linkend="__motor_and_servo_control_8c_1a5c87d10806c8bb41d42841fc2fb559d9">QueueSetPIDNecessaryCommands</link>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00007"/>00007 <emphasis role="keyword">extern</emphasis>&#32;QueueHandle_t&#32;<link linkend="__motor_and_servo_control_8c_1ae0a77b0cf83af5755b406387533338e7">autonomousModeControlPixyQueue</link>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00008"/>00008 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00009"/><link linkend="__motor_and_servo_control_8h_1a5bdc71d98132147d476bffaf9a319080">00009</link> <link linkend="_struct_car_command">CarCommand</link>&#32;<link linkend="__motor_and_servo_control_8c_1a5bdc71d98132147d476bffaf9a319080">parseCommand</link>(<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*commandStr)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00010"/>00010 {
<anchor xml:id="__motor_and_servo_control_8c_source_1l00011"/>00011 &#32;&#32;&#32;&#32;<link linkend="_struct_car_command">CarCommand</link>&#32;cmd;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00012"/>00012 &#32;&#32;&#32;&#32;memset(&amp;cmd,&#32;0,&#32;<emphasis role="keyword">sizeof</emphasis>(cmd));&#32;<emphasis role="comment">//&#32;Initialize&#32;the&#32;structure&#32;with&#32;zeros</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00013"/>00013 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(strncmp(commandStr,&#32;<emphasis role="stringliteral">&quot;08&quot;</emphasis>,&#32;2)&#32;==&#32;0)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00014"/>00014 &#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00015"/>00015 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Handle&#32;command&#32;&quot;08&quot;&#32;specifically&#32;to&#32;parse&#32;KP,&#32;KI,&#32;KD&#32;values</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00016"/>00016 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sscanf(commandStr,&#32;<emphasis role="stringliteral">&quot;08%f&#32;%f&#32;%f&quot;</emphasis>,&#32;&amp;cmd.<link linkend="_struct_car_command_1abf14c0656fbb57a86c322a87af806030">KP</link>,&#32;&amp;cmd.<link linkend="_struct_car_command_1aa7d5dd64817c03d067d0e922cd35d75c">KI</link>,&#32;&amp;cmd.<link linkend="_struct_car_command_1a16424cc4cde718119fedda0db72c792f">KD</link>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00017"/>00017 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1a7cd16e2fee904b8a434a08c7eda5d046">command</link>&#32;=&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a83b13685e6cda59d2c8e05ead61a7287">PID_Changed</link>;&#32;<emphasis role="comment">//&#32;Set&#32;the&#32;command&#32;to&#32;the&#32;appropriate&#32;enum&#32;value</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00018"/>00018 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1a9dfa744f0c79dc3f439d054cc3878eaa">has_value</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Since&#32;KP,&#32;KI,&#32;KD&#32;are&#32;used,&#32;command_value&#32;is&#32;not&#32;relevant</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00019"/>00019 &#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00020"/>00020 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(strlen(commandStr)&#32;&gt;=&#32;2)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00021"/>00021 &#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00022"/>00022 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;commandPart[3]&#32;=&#32;{commandStr[0],&#32;commandStr[1],&#32;<emphasis role="charliteral">&apos;\0&apos;</emphasis>};
<anchor xml:id="__motor_and_servo_control_8c_source_1l00023"/>00023 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1a7cd16e2fee904b8a434a08c7eda5d046">command</link>&#32;=&#32;atoi(commandPart);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00024"/>00024 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Check&#32;if&#32;there&apos;s&#32;more&#32;to&#32;the&#32;command&#32;than&#32;just&#32;the&#32;command&#32;part</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00025"/>00025 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(strlen(commandStr)&#32;&gt;&#32;2)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00026"/>00026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00027"/>00027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1a9dfa744f0c79dc3f439d054cc3878eaa">has_value</link>&#32;=&#32;<emphasis role="keyword">true</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00028"/>00028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Extract&#32;the&#32;command&#32;value,&#32;which&#32;is&#32;optional</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00029"/>00029 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;valuePart[5];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Assuming&#32;the&#32;value&#32;part&#32;will&#32;not&#32;exceed&#32;4&#32;digits</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00030"/>00030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;strncpy(valuePart,&#32;commandStr&#32;+&#32;2,&#32;4);&#32;<emphasis role="comment">//&#32;Copy&#32;the&#32;rest&#32;of&#32;the&#32;string&#32;as&#32;command&#32;value</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00031"/>00031 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;valuePart[4]&#32;=&#32;<emphasis role="charliteral">&apos;\0&apos;</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Null-terminate&#32;the&#32;string</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00032"/>00032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>&#32;=&#32;atoi(valuePart);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00033"/>00033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00034"/>00034 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00035"/>00035 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00036"/>00036 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1a9dfa744f0c79dc3f439d054cc3878eaa">has_value</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00037"/>00037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00038"/>00038 &#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00039"/>00039 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;cmd;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00040"/>00040 }
<anchor xml:id="__motor_and_servo_control_8c_source_1l00041"/>00041 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00042"/><link linkend="__motor_and_servo_control_8h_1a64174a9e686c6f19ea9dc54d1d47085b">00042</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__motor_and_servo_control_8c_1a64174a9e686c6f19ea9dc54d1d47085b">carControl_Backward_init</link>(<emphasis role="keywordtype">int</emphasis>&#32;break_value)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00043"/>00043 {
<anchor xml:id="__motor_and_servo_control_8c_source_1l00044"/>00044 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a435592e73c533f6e72459bff52e6b60e">changeMotorSpeed</link>(0);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00045"/>00045 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(50));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00046"/>00046 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a435592e73c533f6e72459bff52e6b60e">changeMotorSpeed</link>(break_value);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00047"/>00047 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(50));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00048"/>00048 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a435592e73c533f6e72459bff52e6b60e">changeMotorSpeed</link>(0);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00049"/>00049 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(50));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00050"/>00050 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a435592e73c533f6e72459bff52e6b60e">changeMotorSpeed</link>(break_value);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00051"/>00051 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(50));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00052"/>00052 }
<anchor xml:id="__motor_and_servo_control_8c_source_1l00053"/>00053 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00054"/>00054 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00055"/><link linkend="__motor_and_servo_control_8c_1ade0f598b8a5a524e52c60c286fcee6db">00055</link> <emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="__motor_and_servo_control_8c_1ade0f598b8a5a524e52c60c286fcee6db">calib_motor_done</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00056"/><link linkend="__dc_motor_8h_1aacc86a8fac6d46c80e8c5c41ea7786b6">00056</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__motor_and_servo_control_8c_1aacc86a8fac6d46c80e8c5c41ea7786b6">carControl_calibrate_motor</link>()
<anchor xml:id="__motor_and_servo_control_8c_source_1l00057"/>00057 {
<anchor xml:id="__motor_and_servo_control_8c_source_1l00058"/>00058 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(2000);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00059"/>00059 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(3000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00060"/>00060 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1000);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00061"/>00061 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(3000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00062"/>00062 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1500);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00063"/>00063 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(3000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00064"/>00064 &#32;&#32;&#32;&#32;<emphasis role="comment">//ESP_LOGI(&quot;&#32;&quot;,&#32;&quot;ESC&#32;Calibration&#32;over.&quot;);</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00065"/>00065 &#32;&#32;&#32;&#32;<link linkend="__motor_and_servo_control_8c_1ade0f598b8a5a524e52c60c286fcee6db">calib_motor_done</link>&#32;=&#32;<emphasis role="keyword">true</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00066"/>00066 }
<anchor xml:id="__motor_and_servo_control_8c_source_1l00067"/>00067 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00068"/>00068 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;mock_forward_and_backward_test_5_seconds()
<anchor xml:id="__motor_and_servo_control_8c_source_1l00069"/>00069 {
<anchor xml:id="__motor_and_servo_control_8c_source_1l00070"/>00070 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00071"/>00071 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;MOVING&#32;FORWARD&#32;*/</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00072"/>00072 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1600);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00073"/>00073 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(5000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00074"/>00074 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00075"/>00075 &#32;&#32;&#32;&#32;<emphasis role="comment">/*BACKWARD&#32;MODE&#32;INIT*/</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00076"/>00076 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1500);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00077"/>00077 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(1000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00078"/>00078 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1400);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00079"/>00079 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(1000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00080"/>00080 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1500);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00081"/>00081 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(1000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00082"/>00082 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00083"/>00083 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;MOVING&#32;BACKWARD&#32;*/</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00084"/>00084 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1400);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00085"/>00085 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(5000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00086"/>00086 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00087"/>00087 &#32;&#32;&#32;&#32;<emphasis role="comment">/*STOP*/</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00088"/>00088 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1500);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00089"/>00089 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(5000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00090"/>00090 }
<anchor xml:id="__motor_and_servo_control_8c_source_1l00091"/>00091 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00092"/>00092 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;pwm_from_1550_to_1650_step_10()
<anchor xml:id="__motor_and_servo_control_8c_source_1l00093"/>00093 {
<anchor xml:id="__motor_and_servo_control_8c_source_1l00094"/>00094 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;i&#32;=&#32;0;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00095"/>00095 &#32;&#32;&#32;&#32;i++;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00096"/>00096 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1540+i);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00097"/>00097 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(10000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00098"/>00098 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>(i==60)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00099"/>00099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i=0;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00100"/>00100 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00101"/>00101 }
<anchor xml:id="__motor_and_servo_control_8c_source_1l00102"/>00102 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00103"/><link linkend="_main_8c_1a731dce19cc17cfa0419781203697bf14">00103</link> QueueHandle_t&#32;<link linkend="__motor_and_servo_control_8c_1a731dce19cc17cfa0419781203697bf14">diagnosticModeControlQueue</link>&#32;=&#32;NULL;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00104"/><link linkend="__motor_and_servo_control_8c_1a692b48efecf30c3cea7e1271c249b331">00104</link> QueueHandle_t&#32;<link linkend="__motor_and_servo_control_8c_1a692b48efecf30c3cea7e1271c249b331">autonomousModeControlUartQueue</link>&#32;=&#32;NULL;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00105"/><link linkend="_main_8c_1adb1f977be6734adfcc8e37d4f2659ec5">00105</link> QueueHandle_t&#32;<link linkend="__motor_and_servo_control_8c_1adb1f977be6734adfcc8e37d4f2659ec5">speed_commandQueue</link>&#32;=&#32;NULL;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00106"/><link linkend="_main_8c_1a4c4e2a762a11fd2e1ddee7045c9bae56">00106</link> QueueHandle_t&#32;<link linkend="__motor_and_servo_control_8c_1a4c4e2a762a11fd2e1ddee7045c9bae56">steer_commandQueue</link>&#32;=&#32;NULL;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00107"/><link linkend="_main_8c_1a52c196f65d55f3b464764bf630e6f05e">00107</link> QueueHandle_t&#32;<link linkend="__motor_and_servo_control_8c_1a52c196f65d55f3b464764bf630e6f05e">PID_commandQueue</link>&#32;=&#32;NULL;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00108"/><link linkend="_main_8c_1a35af4e2fb01eed708c67a42aad85cebf">00108</link> QueueSetHandle_t&#32;<link linkend="__motor_and_servo_control_8c_1a35af4e2fb01eed708c67a42aad85cebf">QueueSetAutonomousOrDiagnostic</link>&#32;=&#32;NULL;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00109"/>00109 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00110"/>00110 <emphasis role="comment">/*&#32;This&#32;variable&#32;allows&#32;the&#32;uart_task&#32;to&#32;fill&#32;Autonomous&#32;Queue&#32;for&#32;controlling&#32;the&#32;car.&#32;*/</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00111"/><link linkend="__i2_c__sensor_control_8c_1aaa8698890fe268d44ede1ad83c711ffb">00111</link> <emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="__motor_and_servo_control_8c_1aaa8698890fe268d44ede1ad83c711ffb">AutonomousMode</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00112"/><link linkend="__motor_and_servo_control_8h_1a356958ec8c1d6b214ec4228ce5ae6f56">00112</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__motor_and_servo_control_8c_1a356958ec8c1d6b214ec4228ce5ae6f56">carControl_Task</link>(<emphasis role="keywordtype">void</emphasis>&#32;*pvParameters)&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00113"/>00113 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00114"/>00114 <emphasis role="preprocessor">#if&#32;(MOTOR_MOCK_TEST&#32;==&#32;ON)</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00115"/>00115 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>(1)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00116"/>00116 &#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00117"/>00117 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//ESP_LOGI(&quot;AICI&quot;,&quot;fasf&quot;);</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00118"/>00118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//mock_forward_and_backward_test_5_seconds();</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00119"/>00119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pwm_from_1550_to_1650_step_10();
<anchor xml:id="__motor_and_servo_control_8c_source_1l00120"/>00120 &#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00121"/>00121 <emphasis role="preprocessor">#elif&#32;(MOTOR_MOCK_TEST&#32;==&#32;OFF)</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00122"/>00122 &#32;&#32;&#32;&#32;<link linkend="_struct_car_command">CarCommand</link>&#32;cmd&#32;=&#32;{&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a38ff3124e97bad134a6c47fa91f40273">StopReceived</link>,&#32;0,&#32;<emphasis role="keyword">false</emphasis>,&#32;0.0f,&#32;0.0f,&#32;0.0f&#32;};
<anchor xml:id="__motor_and_servo_control_8c_source_1l00123"/>00123 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;last_motor_speed&#32;=&#32;0;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00124"/>00124 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;speed_multiplier&#32;=&#32;0;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00125"/>00125 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;speed&#32;=&#32;0;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00126"/>00126 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;*command;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00127"/>00127 &#32;&#32;&#32;&#32;QueueSetMemberHandle_t&#32;xActivatedModeAorM_Member;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00128"/>00128 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00129"/>00129 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(1)&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00130"/>00130 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//ESP_LOG(&quot;CarControl_TASK&quot;,&quot;%u&#32;ms&quot;,pdTICKS_TO_MS(xTaskGetTickCount()));</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00131"/>00131 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="__motor_and_servo_control_8c_1a731dce19cc17cfa0419781203697bf14">diagnosticModeControlQueue</link>&#32;!=&#32;NULL&#32;&amp;&amp;&#32;(<link linkend="__motor_and_servo_control_8c_1a692b48efecf30c3cea7e1271c249b331">autonomousModeControlUartQueue</link>&#32;!=&#32;NULL&#32;||&#32;<link linkend="__motor_and_servo_control_8c_1ae0a77b0cf83af5755b406387533338e7">autonomousModeControlPixyQueue</link>&#32;!=&#32;NULL))&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00132"/>00132 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xActivatedModeAorM_Member&#32;=&#32;xQueueSelectFromSet(<link linkend="__motor_and_servo_control_8c_1a35af4e2fb01eed708c67a42aad85cebf">QueueSetAutonomousOrDiagnostic</link>,&#32;portMAX_DELAY);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00133"/>00133 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00134"/>00134 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>(xActivatedModeAorM_Member&#32;==&#32;<link linkend="__motor_and_servo_control_8c_1a731dce19cc17cfa0419781203697bf14">diagnosticModeControlQueue</link>)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00135"/>00135 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00136"/>00136 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="__motor_and_servo_control_8c_1aaa8698890fe268d44ede1ad83c711ffb">AutonomousMode</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00137"/>00137 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xQueueReceive(xActivatedModeAorM_Member,&#32;&amp;command,&#32;0);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00138"/>00138 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd&#32;=&#32;<link linkend="__motor_and_servo_control_8c_1a5bdc71d98132147d476bffaf9a319080">parseCommand</link>(command);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00139"/>00139 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00140"/>00140 <emphasis role="preprocessor">#if&#32;(PIXY_DETECTION&#32;==&#32;OFF)</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00141"/>00141 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>(xActivatedModeAorM_Member&#32;==&#32;<link linkend="__motor_and_servo_control_8c_1a692b48efecf30c3cea7e1271c249b331">autonomousModeControlUartQueue</link>)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00142"/>00142 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00143"/>00143 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xQueueReceive(xActivatedModeAorM_Member,&#32;&amp;command,&#32;0);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00144"/>00144 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00145"/>00145 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>(strncmp(command,<emphasis role="stringliteral">&quot;sp=&quot;</emphasis>,3)==0)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00146"/>00146 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00147"/>00147 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sscanf(command,&#32;<emphasis role="stringliteral">&quot;sp=%d&quot;</emphasis>,&#32;&amp;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00148"/>00148 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1a7cd16e2fee904b8a434a08c7eda5d046">command</link>&#32;=&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a36bfd0a5ed9bd3bf8c1cc31778e6f734">SpeedReceived</link>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00149"/>00149 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00150"/>00150 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>(strncmp(command,<emphasis role="stringliteral">&quot;st=&quot;</emphasis>,3)==0)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00151"/>00151 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00152"/>00152 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sscanf(command,&#32;<emphasis role="stringliteral">&quot;st=%d&quot;</emphasis>,&#32;&amp;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00153"/>00153 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1a7cd16e2fee904b8a434a08c7eda5d046">command</link>&#32;=&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a18f72057a72b84c91c71e9a29779b889">SteerReceived</link>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00154"/>00154 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00155"/>00155 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00156"/>00156 <emphasis role="preprocessor">#elif&#32;(PIXY_DETECTION&#32;==&#32;ON)</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00157"/>00157 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>(xActivatedModeAorM_Member&#32;==&#32;<link linkend="__motor_and_servo_control_8c_1ae0a77b0cf83af5755b406387533338e7">autonomousModeControlPixyQueue</link>)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00158"/>00158 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00159"/>00159 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;uint8_t&#32;nrCmd&#32;=&#32;0U;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00160"/>00160 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nrCmd++;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00161"/>00161 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xQueueReceive(xActivatedModeAorM_Member,&#32;&amp;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>,&#32;0);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00162"/>00162 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>(nrCmd&#32;==&#32;1U)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00163"/>00163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00164"/>00164 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1a7cd16e2fee904b8a434a08c7eda5d046">command</link>&#32;=&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a36bfd0a5ed9bd3bf8c1cc31778e6f734">SpeedReceived</link>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00165"/>00165 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ESP_LOGI(<emphasis role="stringliteral">&quot;PIXY&quot;</emphasis>,<emphasis role="stringliteral">&quot;Speed:&#32;%d&quot;</emphasis>,&#32;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00166"/>00166 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00167"/>00167 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>(nrCmd&#32;==&#32;2U)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00168"/>00168 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00169"/>00169 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cmd.<link linkend="_struct_car_command_1a7cd16e2fee904b8a434a08c7eda5d046">command</link>&#32;=&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a18f72057a72b84c91c71e9a29779b889">SteerReceived</link>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00170"/>00170 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ESP_LOGI(<emphasis role="stringliteral">&quot;PIXY&quot;</emphasis>,<emphasis role="stringliteral">&quot;Steer:&#32;%d&quot;</emphasis>,&#32;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00171"/>00171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nrCmd&#32;=&#32;0U;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00172"/>00172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00173"/>00173 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00174"/>00174 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00175"/>00175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00176"/>00176 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00177"/>00177 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00178"/>00178 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00179"/>00179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(cmd.<link linkend="_struct_car_command_1a7cd16e2fee904b8a434a08c7eda5d046">command</link>)&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00180"/>00180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a38ff3124e97bad134a6c47fa91f40273">StopReceived</link>:
<anchor xml:id="__motor_and_servo_control_8c_source_1l00181"/>00181 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;speed&#32;=&#32;0;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00182"/>00182 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xQueueSend(<link linkend="__motor_and_servo_control_8c_1adb1f977be6734adfcc8e37d4f2659ec5">speed_commandQueue</link>,&amp;speed,portMAX_DELAY);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00183"/>00183 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;speed_multiplier&#32;=&#32;0;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00184"/>00184 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00185"/>00185 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a2f84761275322f61b7e1abea99187620">ForwardReceived</link>:
<anchor xml:id="__motor_and_servo_control_8c_source_1l00186"/>00186 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;speed_multiplier&#32;=&#32;1;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00187"/>00187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;speed&#32;=&#32;speed_multiplier&#32;*&#32;last_motor_speed;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00188"/>00188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xQueueSend(<link linkend="__motor_and_servo_control_8c_1adb1f977be6734adfcc8e37d4f2659ec5">speed_commandQueue</link>,&amp;speed,portMAX_DELAY);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00189"/>00189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="__network_8h_1abeb264090352ce377a3c339bd3abe1fc">HLD_SendMessage</link>(<emphasis role="stringliteral">&quot;OKFWD!&quot;</emphasis>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00190"/>00190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00191"/>00191 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6ac47cb1c3582d438ab4dbaf9303c0a5c2">BackwardReceived</link>:
<anchor xml:id="__motor_and_servo_control_8c_source_1l00192"/>00192 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;speed_multiplier&#32;=&#32;-1;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00193"/>00193 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;speed&#32;=&#32;speed_multiplier&#32;*&#32;last_motor_speed;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00194"/>00194 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xQueueSend(<link linkend="__motor_and_servo_control_8c_1adb1f977be6734adfcc8e37d4f2659ec5">speed_commandQueue</link>,&amp;speed,portMAX_DELAY);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00195"/>00195 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="__network_8h_1abeb264090352ce377a3c339bd3abe1fc">HLD_SendMessage</link>(<emphasis role="stringliteral">&quot;OKBWD!&quot;</emphasis>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00196"/>00196 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00197"/>00197 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a36bfd0a5ed9bd3bf8c1cc31778e6f734">SpeedReceived</link>:
<anchor xml:id="__motor_and_servo_control_8c_source_1l00198"/>00198 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>(<link linkend="__motor_and_servo_control_8c_1aaa8698890fe268d44ede1ad83c711ffb">AutonomousMode</link>&#32;==&#32;<emphasis role="keyword">false</emphasis>)
<anchor xml:id="__motor_and_servo_control_8c_source_1l00199"/>00199 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;speed&#32;=&#32;speed_multiplier&#32;*&#32;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00200"/>00200 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00201"/>00201 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;speed&#32;=&#32;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00202"/>00202 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00203"/>00203 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xQueueSend(<link linkend="__motor_and_servo_control_8c_1adb1f977be6734adfcc8e37d4f2659ec5">speed_commandQueue</link>,&amp;speed,portMAX_DELAY);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00204"/>00204 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;last_motor_speed&#32;=&#32;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00205"/>00205 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="__network_8h_1abeb264090352ce377a3c339bd3abe1fc">HLD_SendMessage</link>(<emphasis role="stringliteral">&quot;OKSPEED!&quot;</emphasis>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00206"/>00206 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00207"/>00207 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a18f72057a72b84c91c71e9a29779b889">SteerReceived</link>:
<anchor xml:id="__motor_and_servo_control_8c_source_1l00208"/>00208 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xQueueSend(<link linkend="__motor_and_servo_control_8c_1a4c4e2a762a11fd2e1ddee7045c9bae56">steer_commandQueue</link>,&amp;cmd.<link linkend="_struct_car_command_1ab80a641a1922d03fd19935a5efd1f44b">command_value</link>,portMAX_DELAY);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00209"/>00209 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="__network_8h_1abeb264090352ce377a3c339bd3abe1fc">HLD_SendMessage</link>(<emphasis role="stringliteral">&quot;OKSTEER!&quot;</emphasis>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00210"/>00210 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00211"/>00211 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6af7d72e81b866e7bd38f8ba2240caee98">AutonomousReceived</link>:
<anchor xml:id="__motor_and_servo_control_8c_source_1l00212"/>00212 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="__motor_and_servo_control_8c_1aaa8698890fe268d44ede1ad83c711ffb">AutonomousMode</link>&#32;=&#32;<emphasis role="keyword">true</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00213"/>00213 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ESP_LOGI(<emphasis role="stringliteral">&quot;Auton&quot;</emphasis>,&#32;<emphasis role="stringliteral">&quot;&quot;</emphasis>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00214"/>00214 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00215"/>00215 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="__motor_and_servo_control_8h_1a7b15d67975290586b9379fb94d061cf6a83b13685e6cda59d2c8e05ead61a7287">PID_Changed</link>:
<anchor xml:id="__motor_and_servo_control_8c_source_1l00216"/>00216 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;xQueueSend(<link linkend="__motor_and_servo_control_8c_1a52c196f65d55f3b464764bf630e6f05e">PID_commandQueue</link>,&amp;cmd,portMAX_DELAY);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00217"/>00217 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="__network_8h_1abeb264090352ce377a3c339bd3abe1fc">HLD_SendMessage</link>(<emphasis role="stringliteral">&quot;OKPID!&quot;</emphasis>);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00218"/>00218 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00219"/>00219 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00220"/>00220 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00221"/>00221 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00222"/>00222 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(250));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00223"/>00223 &#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00224"/>00224 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00225"/>00225 }
<anchor xml:id="__motor_and_servo_control_8c_source_1l00226"/>00226 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00227"/><link linkend="__motor_and_servo_control_8h_1a111cf66cc0671765a5325a79a37773a2">00227</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__motor_and_servo_control_8c_1a111cf66cc0671765a5325a79a37773a2">steer_task</link>(<emphasis role="keywordtype">void</emphasis>&#32;*pvParameters)&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00228"/>00228 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;steer&#32;=&#32;0;
<anchor xml:id="__motor_and_servo_control_8c_source_1l00229"/>00229 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(1)&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00230"/>00230 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="__motor_and_servo_control_8c_1a4c4e2a762a11fd2e1ddee7045c9bae56">steer_commandQueue</link>&#32;!=&#32;NULL)&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00231"/>00231 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(xQueueReceive(<link linkend="__motor_and_servo_control_8c_1a4c4e2a762a11fd2e1ddee7045c9bae56">steer_commandQueue</link>,&#32;&amp;steer,&#32;portMAX_DELAY)&#32;==&#32;pdPASS)&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00232"/>00232 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="__servo_motor_8h_1ad0d869b0abb9912862634615c3563d9c">changeSTEER</link>(steer);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00233"/>00233 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00234"/>00234 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00235"/>00235 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(250));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00236"/>00236 &#32;&#32;&#32;&#32;}
<anchor xml:id="__motor_and_servo_control_8c_source_1l00237"/>00237 }
<anchor xml:id="__motor_and_servo_control_8c_source_1l00238"/>00238 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00239"/><link linkend="__motor_and_servo_control_8h_1a3b1a84c1a0e08894d761413c5c66c701">00239</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__motor_and_servo_control_8c_1a3b1a84c1a0e08894d761413c5c66c701">carControl_init</link>()&#32;{
<anchor xml:id="__motor_and_servo_control_8c_source_1l00240"/>00240 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00241"/>00241 &#32;&#32;&#32;&#32;<link linkend="__servo_motor_8h_1a471346290cd96bae9ad577caa60fce18">init_servo_pwm</link>();
<anchor xml:id="__motor_and_servo_control_8c_source_1l00242"/>00242 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a611fa4f4361e4e307befb3becc0a5f4f">init_motor_pwm</link>();
<anchor xml:id="__motor_and_servo_control_8c_source_1l00243"/>00243 &#32;&#32;&#32;&#32;<link linkend="__servo_motor_8h_1af33292d0ddf5be1cc69616acceb92a3a">update_servo_pwm</link>(1500);&#32;<emphasis role="comment">//&#32;ESC&#32;init</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00244"/>00244 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(2000));
<anchor xml:id="__motor_and_servo_control_8c_source_1l00245"/>00245 &#32;&#32;&#32;&#32;<link linkend="__dc_motor_8h_1a701f471f5cefb57b8bd8d0fc2e8b9597">update_motor_pwm</link>(1500);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00246"/>00246 &#32;&#32;&#32;&#32;<emphasis role="comment">//carControl_calibrate_motor();</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00247"/>00247 &#32;&#32;&#32;&#32;<emphasis role="comment">//while(calib_motor_done!=true)&#32;vTaskDelay(pdMS_TO_TICKS(50));</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00248"/>00248 &#32;&#32;&#32;&#32;vTaskDelay(pdMS_TO_TICKS(500));&#32;<emphasis role="comment">//&#32;wait&#32;for&#32;init&#32;to&#32;complete</emphasis>
<anchor xml:id="__motor_and_servo_control_8c_source_1l00249"/>00249 &#32;&#32;&#32;&#32;xTaskCreatePinnedToCore(<link linkend="__motor_and_servo_control_8c_1a356958ec8c1d6b214ec4228ce5ae6f56">carControl_Task</link>,&#32;<emphasis role="stringliteral">&quot;carControl_task&quot;</emphasis>,&#32;4096,&#32;NULL,&#32;6,
<anchor xml:id="__motor_and_servo_control_8c_source_1l00250"/>00250 &#32;&#32;&#32;&#32;NULL,&#32;0U);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00251"/>00251 &#32;&#32;&#32;&#32;xTaskCreatePinnedToCore(<link linkend="__motor_and_servo_control_8c_1a111cf66cc0671765a5325a79a37773a2">steer_task</link>,&#32;<emphasis role="stringliteral">&quot;steer_task&quot;</emphasis>,&#32;4096,&#32;NULL,&#32;5,NULL,&#32;1U);
<anchor xml:id="__motor_and_servo_control_8c_source_1l00252"/>00252 
<anchor xml:id="__motor_and_servo_control_8c_source_1l00253"/>00253 }
<anchor xml:id="__motor_and_servo_control_8c_source_1l00254"/>00254 
</programlisting></section>
