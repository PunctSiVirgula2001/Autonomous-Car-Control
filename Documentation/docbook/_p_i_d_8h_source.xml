<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__p_i_d_8h_source" xml:lang="en-US">
<title>PID.h</title>
<indexterm><primary>include/PID.h</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="__p_i_d_8h_source_1l00001"/>00001 <emphasis role="preprocessor">#include&#32;&quot;esp_freertos_hooks.h&quot;</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00002"/>00002 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="__motor_and_servo_control_8h">MotorAndServoControl.h</link>&quot;</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00003"/>00003 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="__i2_c__sensor_control_8h">I2C_sensorControl.h</link>&quot;</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00004"/>00004 
<anchor xml:id="__p_i_d_8h_source_1l00005"/>00005 
<anchor xml:id="__p_i_d_8h_source_1l00006"/>00006 <emphasis role="comment">/*&#32;PID&#32;settings&#32;*/</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00007"/><link linkend="__p_i_d_8h_1adc355b3d08d4e503e9067cf00bc8d30b">00007</link> <emphasis role="preprocessor">#define&#32;PID_MAX_WINDUP&#32;5&#32;</emphasis><emphasis role="comment">//&#32;Maximum&#32;windup&#32;value&#32;for&#32;the&#32;PID&#32;controller&#32;(to&#32;be&#32;tested)</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00008"/><link linkend="__p_i_d_8h_1a38bf51002d82306531629d65d518ac46">00008</link> <emphasis role="preprocessor">#define&#32;PID_D_TERM_FILTER_COEFFICIENT&#32;0.5&#32;</emphasis><emphasis role="comment">//&#32;Coefficient&#32;for&#32;filtering&#32;the&#32;derivative&#32;term&#32;(to&#32;be&#32;tested)</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00009"/><link linkend="__p_i_d_8h_1a10cc9812fdaf0a487eefbf2711f08257">00009</link> <emphasis role="preprocessor">#define&#32;PID_OUT_LIMIT_RATE_CHANGE&#32;5&#32;</emphasis><emphasis role="comment">//&#32;Maximum&#32;rate&#32;of&#32;change&#32;for&#32;the&#32;PID&#32;output&#32;(represents&#32;the&#32;difference&#32;between&#32;outputs)</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00010"/><link linkend="__p_i_d_8h_1a038513bad8c72a54a00551fc2448c546">00010</link> <emphasis role="preprocessor">#define&#32;low_pass_filter_derivative_chan&#32;ON&#32;&#32;</emphasis><emphasis role="comment">//&#32;Set&#32;to&#32;ON&#32;or&#32;OFF</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00011"/>00011 
<anchor xml:id="__p_i_d_8h_source_1l00012"/>00012 <emphasis role="comment">//&#32;PID&#32;Structure</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00013"/><link linkend="_struct_p_i_d__t">00013</link> <emphasis role="keyword">typedef</emphasis>&#32;<emphasis role="keyword">struct&#32;</emphasis>{
<anchor xml:id="__p_i_d_8h_source_1l00014"/><link linkend="_struct_p_i_d__t_1af92a67282f64b636796ff0120d21310f">00014</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_struct_p_i_d__t_1af92a67282f64b636796ff0120d21310f">setpoint</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Desired&#32;value</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00015"/><link linkend="_struct_p_i_d__t_1a4dba95b4ef2edf5118b52a3bb9913556">00015</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a4dba95b4ef2edf5118b52a3bb9913556">measured</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Current&#32;value</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00016"/><link linkend="_struct_p_i_d__t_1a01de8920e5c316977aa9b41f4967aab4">00016</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a01de8920e5c316977aa9b41f4967aab4">previous_error</link>;&#32;<emphasis role="comment">//&#32;Previous&#32;error&#32;value</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00017"/><link linkend="_struct_p_i_d__t_1a1174af01b8a329a6d465ea6e0951b3e5">00017</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a1174af01b8a329a6d465ea6e0951b3e5">integral</link>;&#32;&#32;&#32;<emphasis role="comment">//&#32;Integral&#32;term</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00018"/><link linkend="_struct_p_i_d__t_1a09cfc766a233ad617270562cc4146d07">00018</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a09cfc766a233ad617270562cc4146d07">Kp</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Proportional&#32;gain</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00019"/><link linkend="_struct_p_i_d__t_1a59fac16f568541187ff485c4c47b0ec5">00019</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a59fac16f568541187ff485c4c47b0ec5">Ki</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Integral&#32;gain</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00020"/><link linkend="_struct_p_i_d__t_1a98268d71502ba080d88a9b1f50fdbe80">00020</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a98268d71502ba080d88a9b1f50fdbe80">Kd</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Derivative&#32;gain</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00021"/><link linkend="_struct_p_i_d__t_1a60e830ee0f71c2d98c55973a6f9b7b05">00021</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a60e830ee0f71c2d98c55973a6f9b7b05">P_term</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Proportional&#32;term</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00022"/><link linkend="_struct_p_i_d__t_1a280250765dafe1df642b33b1243a9950">00022</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a280250765dafe1df642b33b1243a9950">I_term</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Integral&#32;term</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00023"/><link linkend="_struct_p_i_d__t_1ac5a0f95bee23553dab250fd0d16a89b6">00023</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1ac5a0f95bee23553dab250fd0d16a89b6">D_term</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Derivative&#32;term</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00024"/><link linkend="_struct_p_i_d__t_1ae3c8e9801e0e0bd9cdf270f757070a70">00024</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_struct_p_i_d__t_1ae3c8e9801e0e0bd9cdf270f757070a70">Output</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;PID&#32;output</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00025"/><link linkend="_struct_p_i_d__t_1a6ffcf63b1b4a6438fe0d55074206446b">00025</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a6ffcf63b1b4a6438fe0d55074206446b">previousOutput</link>;
<anchor xml:id="__p_i_d_8h_source_1l00026"/>00026 <emphasis role="preprocessor">#if&#32;low_pass_filter_derivative_chan&#32;==&#32;ON</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00027"/><link linkend="_struct_p_i_d__t_1a03ec09eeaedd2105010cbb15a8e4f2dd">00027</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1a03ec09eeaedd2105010cbb15a8e4f2dd">previous_D_term</link>;&#32;<emphasis role="comment">//&#32;Add&#32;this&#32;to&#32;store&#32;the&#32;previous&#32;derivative&#32;term</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00028"/><link linkend="_struct_p_i_d__t_1ab1551d8043c2aa4410fb7dbb1fe3be7b">00028</link> &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_struct_p_i_d__t_1ab1551d8043c2aa4410fb7dbb1fe3be7b">alpha</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Smoothing&#32;factor&#32;for&#32;the&#32;low-pass&#32;filter</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00029"/>00029 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00030"/>00030 }&#32;<link linkend="_struct_p_i_d__t">PID_t</link>;
<anchor xml:id="__p_i_d_8h_source_1l00031"/>00031 
<anchor xml:id="__p_i_d_8h_source_1l00032"/>00032 <emphasis role="comment">//&#32;PID&#32;Initialization</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00033"/>00033 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__p_i_d_8h_1a26c8b95db9397895630f51f4d291aab5">PID_Init</link>(<link linkend="_struct_p_i_d__t">PID_t</link>&#32;*pid,&#32;<emphasis role="keywordtype">float</emphasis>&#32;Kp,&#32;<emphasis role="keywordtype">float</emphasis>&#32;Ki,&#32;<emphasis role="keywordtype">float</emphasis>&#32;Kd);
<anchor xml:id="__p_i_d_8h_source_1l00034"/>00034 
<anchor xml:id="__p_i_d_8h_source_1l00035"/>00035 <emphasis role="comment">//&#32;Compute&#32;PID</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00036"/>00036 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__p_i_d_8h_1a6120ff3d44feed1033e54547b47c7856">PID_Compute</link>(<link linkend="_struct_p_i_d__t">PID_t</link>&#32;*pid);
<anchor xml:id="__p_i_d_8h_source_1l00037"/>00037 
<anchor xml:id="__p_i_d_8h_source_1l00038"/>00038 <emphasis role="comment">/*&#32;PID&#32;update&#32;params&#32;*/</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00039"/>00039 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__p_i_d_8h_1ad55b9d5b8311b147f528a7e6d0fba01c">PID_UpdateParams</link>(<link linkend="_struct_p_i_d__t">PID_t</link>&#32;*pid,&#32;<emphasis role="keywordtype">float</emphasis>&#32;new_Kp,&#32;<emphasis role="keywordtype">float</emphasis>&#32;new_Ki,&#32;<emphasis role="keywordtype">float</emphasis>&#32;new_Kd);
<anchor xml:id="__p_i_d_8h_source_1l00040"/>00040 
<anchor xml:id="__p_i_d_8h_source_1l00041"/>00041 <emphasis role="comment">/*&#32;PID&#32;Task&#32;*/</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00042"/>00042 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__p_i_d_8h_1a0b5432e9eb596af445a114d06ffccd81">PIDTask</link>(<emphasis role="keywordtype">void</emphasis>&#32;*pvParameters);
<anchor xml:id="__p_i_d_8h_source_1l00043"/>00043 
<anchor xml:id="__p_i_d_8h_source_1l00044"/>00044 <emphasis role="comment">/*&#32;Sliding&#32;mean&#32;average&#32;settings&#32;*/</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00045"/><link linkend="__p_i_d_8h_1a4976bce6bc5be73bd93625c12b853e70">00045</link> <emphasis role="preprocessor">#define&#32;WINDOW_SIZE_SMA&#32;15&#32;</emphasis><emphasis role="comment">//&#32;Window&#32;size&#32;for&#32;sliding&#32;mean&#32;average</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00046"/>00046 
<anchor xml:id="__p_i_d_8h_source_1l00047"/>00047 <emphasis role="comment">/*&#32;Sliding&#32;Mean&#32;Average&#32;function&#32;*/</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00048"/>00048 <emphasis role="keywordtype">double</emphasis>&#32;<link linkend="__p_i_d_8h_1aa67df0089f15bc7920286170fbdf904b">Sliding_Mean_Average</link>(<emphasis role="keywordtype">int</emphasis>&#32;newValue);
<anchor xml:id="__p_i_d_8h_source_1l00049"/>00049 
<anchor xml:id="__p_i_d_8h_source_1l00050"/>00050 <emphasis role="comment">/*Clamp&#32;function&#32;for&#32;PID&#32;-&#32;types*/</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00051"/>00051 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__p_i_d_8h_1a616f6b0cb89c5861abaa85bbd1058645">clamp_float</link>(<emphasis role="keywordtype">float</emphasis>&#32;*value,&#32;<emphasis role="keywordtype">float</emphasis>&#32;min,&#32;<emphasis role="keywordtype">float</emphasis>&#32;max);
<anchor xml:id="__p_i_d_8h_source_1l00052"/>00052 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__p_i_d_8h_1a7a4dd36c5f2e49d4aa2f2f48fdd0aabe">clamp_int</link>(<emphasis role="keywordtype">int</emphasis>&#32;*value,&#32;<emphasis role="keywordtype">int</emphasis>&#32;min,&#32;<emphasis role="keywordtype">int</emphasis>&#32;max);
<anchor xml:id="__p_i_d_8h_source_1l00053"/>00053 
<anchor xml:id="__p_i_d_8h_source_1l00054"/>00054 <emphasis role="comment">/*START&#32;PID&#32;TASK&#32;function*/</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00055"/>00055 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__p_i_d_8h_1a9e7e9a86b0b7bb64ee265afc5cb27264">start_PID_task</link>();
<anchor xml:id="__p_i_d_8h_source_1l00056"/>00056 
<anchor xml:id="__p_i_d_8h_source_1l00057"/>00057 <emphasis role="keywordtype">float</emphasis>&#32;<link linkend="__p_i_d_8h_1aabae7507a2291726cf102c305e3f02c5">get_speed_distance_sens_scaling</link>(<emphasis role="keywordtype">float</emphasis>&#32;speed,&#32;<emphasis role="keywordtype">float</emphasis>&#32;speed_min,&#32;<emphasis role="keywordtype">float</emphasis>&#32;speed_max);
<anchor xml:id="__p_i_d_8h_source_1l00058"/>00058 
<anchor xml:id="__p_i_d_8h_source_1l00059"/>00059 <emphasis role="comment">/*&#32;Tick&#32;hook&#32;for&#32;continuosly&#32;updating&#32;car&apos;s&#32;speed&#32;to&#32;0&#32;when&apos;s&#32;needed.&#32;*/</emphasis>
<anchor xml:id="__p_i_d_8h_source_1l00060"/>00060 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__p_i_d_8h_1affd6ece3243c73ae7033a9e67d3f23c2">speedCheckTickHook</link>(<emphasis role="keywordtype">void</emphasis>);
<anchor xml:id="__p_i_d_8h_source_1l00061"/>00061 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__p_i_d_8h_1ab1cfced9ea996bf91c861133e0d91e49">init_speedCheckTickHook</link>(<emphasis role="keywordtype">void</emphasis>);
</programlisting></section>
